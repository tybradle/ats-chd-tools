---
phase: 01-project-package-scoping-entry-ux
plan: 04
type: execute
wave: 4
depends_on:
  - 01-03
files_modified:
  - src/pages/bom.tsx
  - src/pages/bom-project.tsx
  - src/pages/home.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Landing page shows module tiles; non-ready modules are disabled and labeled 'Coming soon'"
    - "Entering BOM module immediately prompts a blocking Project Manager modal"
  artifacts:
    - path: "src/pages/home.tsx"
      provides: "Landing page module tiles with disabled/non-ready state"
    - path: "src/pages/bom.tsx"
      provides: "BOM workspace entry that enforces scope selection"
  key_links:
    - from: "src/pages/home.tsx"
      to: "react-router <Link> / route navigation"
      via: "tile click handling"
      pattern: "Coming soon|disabled"
    - from: "src/pages/bom.tsx"
      to: "src/components/bom/project-manager-dialog.tsx"
      via: "controlled open state"
      pattern: "<ProjectManagerDialog.*open="
---

<objective>
Deliver Phase 1 entry UX: landing page module tiles reflect readiness, and BOM entry is always gated by a blocking scope-selection modal.

Purpose: Users reliably enter BOM Translation in the correct Project/Package context.
Output: Landing tiles updated + `/bom` route refactored into a gated workspace entry with a scope display + "Change" wiring.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-project-package-scoping-entry-ux/01-CONTEXT.md
@.planning/phases/01-project-package-scoping-entry-ux/01-RESEARCH.md

@src/pages/bom.tsx
@src/pages/bom-project.tsx
@src/stores/bom-store.ts
@src/pages/home.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 0: Update landing page module tiles to show disabled 'Coming soon' for non-ready modules</name>
  <files>src/pages/home.tsx</files>
  <action>
Implement APP-01 explicitly in the home/landing module tiles:

- Identify the module tiles list/rendering on `src/pages/home.tsx`.
- For any module that is not ready (anything other than BOM Translation for this phase), render the tile in a visually disabled state and add a clear "Coming soon" label.
- Disabled tile behavior requirements:
  - Clicking the tile does nothing (no navigation).
  - Cursor/hover states reflect disabled (e.g., `cursor-not-allowed`, reduced opacity).
  - The tile is still visible (do not hide modules).

Implementation note:
- If tiles currently use `<Link>` to navigate, conditionally render a non-link wrapper for disabled modules (or prevent default on click) so it is impossible to navigate.
- Keep the existing tile data structure/pattern; this should be a minimal change localized to the landing page.
  </action>
  <verify>
Run: `npm run tauri:dev`, then open the Home screen and confirm non-ready module tiles show "Coming soon" and cannot be clicked.
  </verify>
  <done>
Landing page tiles clearly indicate non-ready modules as disabled and labeled "Coming soon"; only ready modules navigate.
  </done>
</task>

<task type="auto">
  <name>Task 1: Make /bom a workspace entry that always opens a blocking scope modal</name>
  <files>
src/pages/bom.tsx
src/App.tsx
src/pages/bom-project.tsx
  </files>
  <action>
Refactor routing + BOM entry UX per phase context:

1) Update `src/pages/bom.tsx` so it becomes the BOM workspace page (not the project list card). It must:
- On initial mount: open `ProjectManagerDialog` immediately.
- Keep dialog open (blocking) until `useBOMStore().currentScopePackageId` is set.
- Render the BOM workspace behind the modal, but keep it visually/interaction disabled until a scope is selected.

Blocking behavior wiring constraint:
- Do NOT modify `src/components/bom/project-manager-dialog.tsx` in this plan.
- Enforce "cannot close until scope selected" purely via the controlled `open` + `onOpenChange` logic in `BomPage`.
  - Example: ignore `onOpenChange(false)` when `currentScopePackageId` is null.

2) Keep (or temporarily keep) `BomProjectPage` route only as a compatibility redirect:
- Update `src/pages/bom-project.tsx` to read the route param and treat it as a **package id**, calling `useBOMStore().setScope(Number(param))` then navigate to `/bom`.
- Even with a deep link, the modal should still open on `/bom` (context requires always prompting on entry).

3) Update `src/App.tsx`:
- Prefer a single `/bom` route as the main workspace entry.
- Keep `/bom/:projectId` route if needed for backwards compatibility, but ensure it ends up at `/bom`.

4) Add a left-side scope section inside the BOM page layout (within the page content area, not the app-wide sidebar):
- Show current job project number + package name.
- Provide a "Change" button that opens the ProjectManagerDialog.

Non-goals:
- Do not change the landing page scope display (explicitly excluded by context).
  </action>
  <verify>
Run: `npm run tauri:dev` and navigate to `http://localhost:1420/bom` â€” Project Manager modal opens immediately.
  </verify>
  <done>
Entering `/bom` always opens the modal, and BOM workspace cannot be used until a scope is selected.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds.
</verification>

<success_criteria>
- Phase 1 success criteria #1-#2 are satisfied in the running desktop app.
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-package-scoping-entry-ux/01-04-SUMMARY.md`
</output>
