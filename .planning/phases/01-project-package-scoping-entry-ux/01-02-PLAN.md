---
phase: 01-project-package-scoping-entry-ux
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/types/bom.ts
  - src/lib/db/real-client.ts
  - src/lib/db/mock-client.ts
  - src/lib/db/client.ts
autonomous: true

must_haves:
  truths:
    - "Projects (job #) can be created and listed"
    - "Packages can be created and listed under a selected Project"
    - "Package names are enforced unique within a Project"
  artifacts:
    - path: "src/lib/db/real-client.ts"
      provides: "SQL helpers for bom_job_projects and bom_packages"
      contains: "export const bomJobProjects"
    - path: "src/types/bom.ts"
      provides: "Types for job projects + packages"
      contains: "export interface BOMJobProject"
  key_links:
    - from: "src/lib/db/real-client.ts"
      to: "bom_packages"
      via: "queries and writes"
      pattern: "FROM bom_packages|INSERT INTO bom_packages|UPDATE bom_packages"
---

<objective>
Expose the new Project(job#)/Package schema via typed DB helper functions (real + mock).

Purpose: Provide a stable data layer for the BOM store and Project Manager UI.
Output: Updated DB clients and types for job projects + packages.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-project-package-scoping-entry-ux/01-CONTEXT.md
@.planning/phases/01-project-package-scoping-entry-ux/01-RESEARCH.md

@src/types/bom.ts
@src/lib/db/real-client.ts
@src/lib/db/mock-client.ts
@src/lib/db/client.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add BOM Job Project + Package types</name>
  <files>src/types/bom.ts</files>
  <action>
Update `src/types/bom.ts` to introduce explicit types for Phase 1 scoping:

- `BOMJobProject` (id, project_number, created_at, updated_at)
- `BOMPackage` (id, project_id, package_name, name, description, version, metadata, created_at, updated_at)
- `BOMPackageWithCounts` (extends BOMPackage with location_count + item_count)

Important compatibility rule for Phase 1: keep `BOMLocation.project_id` and `BOMItem.project_id` meaning “package id” (workspace scope), even if the name remains `project_id`.

Minimize churn: existing `BOMProject`/`BOMProjectWithCounts` may be retained temporarily if still referenced, but prefer migrating callers to `BOMPackageWithCounts` in subsequent plans.
  </action>
  <verify>
Run: `npm run build`
  </verify>
  <done>
Types compile and represent both job-projects and packages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add DB helper modules for bom_job_projects and bom_packages (real + mock)</name>
  <files>
src/lib/db/real-client.ts
src/lib/db/mock-client.ts
src/lib/db/client.ts
  </files>
  <action>
Implement new data access helpers:

In `src/lib/db/real-client.ts`:
- Add `bomJobProjects` with methods:
  - `getAll()` (ordered by updated_at desc or project_number)
  - `getById(id)`
  - `create(projectNumber)`
  - `update(id, updates: { project_number?: string })` (set updated_at)
  - `delete(id)` (cascades to packages via FK)

- Add `bomPackages` with methods:
  - `getByProject(projectId)`
  - `getById(id)`
  - `getAllWithCounts()` and/or `getByIdWithCounts(id)` (join bom_locations + bom_items; count distinct)
  - `create(projectId, packageName, name?, description?, version='1.0')`
  - `update(id, updates)` (package_name/name/description/version/metadata; set updated_at)
  - `delete(id)`

All SQL must use `?` placeholders.

In `src/lib/db/mock-client.ts`:
- Extend the mock store to support job projects and packages separately (new Maps + id counters).
- Keep the seeded mock data working by seeding:
  - one job project (project_number)
  - one package under it (package_name)
  - locations/items referencing the package id.

In `src/lib/db/client.ts`:
- Export `bomJobProjects` and `bomPackages` via the Real/Mock switch.

Non-goal for this plan: updating Zustand store/UI to use these new helpers (that happens in Plan 01-03/01-04).
  </action>
  <verify>
Run: `npm run build` and `npm run lint`
  </verify>
  <done>
DB layer provides CRUD for job projects and packages (real + mock) and compiles cleanly.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds.
- `npm run lint` succeeds.
</verification>

<success_criteria>
- Codebase has typed accessors for Projects(job#) and Packages.
- Uniqueness rules are enforced by SQLite constraints (and will surface as errors to map in UI later).
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-package-scoping-entry-ux/01-02-SUMMARY.md`
</output>
